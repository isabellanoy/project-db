<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"
              name="FacturaCliente" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">

    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="One Empty Record"/>
    <style name="Title" fontName="Arial" fontSize="26" isBold="true"/>
    <style name="Header" fontName="Arial" fontSize="12" isBold="true"/>
    <style name="Detail" fontName="Arial" fontSize="10"/>
    <style name="Footer" fontName="Arial" fontSize="8" isItalic="true"/>

    <!-- Subdataset for the line items -->
    <subDataset name="LineItemsDataset">
        <queryString language="json">
            <![CDATA[]]>
        </queryString>
        <field name="tipo_servicio" class="java.lang.String"/>
        <field name="servicio_descripcion" class="java.lang.String"/>
        <field name="servicio_info_adicional_1" class="java.lang.String"/>
        <field name="cantidad" class="java.lang.String"/>
        <field name="costo_subtotal" class="java.lang.String"/>
    </subDataset>

    <!-- All data now comes in as fields from a single JSON record -->
    <queryString language="json">
        <![CDATA[]]>
    </queryString>
    <field name="p_cliente_nombre" class="java.lang.String"/>
    <field name="p_cliente_ci" class="java.lang.String"/>
    <field name="p_cliente_direccion" class="java.lang.String"/>
    <field name="p_fecha_compra" class="java.lang.String"/>
    <field name="p_compra_cod" class="java.lang.String"/>
    <field name="p_monto_total" class="java.lang.String"/>
    <field name="p_compensacion" class="java.lang.String"/>


    <!-- Encabezado de la Factura -->
    <title>
        <band height="150" splitType="Stretch">
            <staticText>
                <reportElement style="Title" x="0" y="10" width="260" height="30"/>
                <text><![CDATA[FACTURA]]></text>
            </staticText>
            <staticText>
                <reportElement style="Header" x="0" y="50" width="100" height="20"/>
                <text><![CDATA[ViajesUCAB]]></text>
            </staticText>
            <textField>
                <reportElement style="Header" x="400" y="10" width="155" height="20"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA["Factura N°: " + $F{p_compra_cod}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement style="Detail" x="400" y="30" width="155" height="20"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA["Fecha: " + $F{p_fecha_compra}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement style="Header" x="0" y="80" width="120" height="20"/>
                <text><![CDATA[Facturar a:]]></text>
            </staticText>
            <textField>
                <reportElement style="Detail" x="0" y="100" width="280" height="15"/>
                <textFieldExpression><![CDATA[$F{p_cliente_nombre}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement style="Detail" x="0" y="115" width="280" height="15"/>
                <textFieldExpression><![CDATA["CI/RIF: " + $F{p_cliente_ci}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement style="Detail" x="0" y="130" width="280" height="15"/>
                <textFieldExpression><![CDATA[$F{p_cliente_direccion}]]></textFieldExpression>
            </textField>
        </band>
    </title>

    <!-- The detail band now contains the list component -->
    <detail>
        <band height="60">
             <componentElement>
                <reportElement x="0" y="0" width="555" height="60"/>
                <jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
                    <datasetRun subDataset="LineItemsDataset">
                        <dataSourceExpression><![CDATA[((net.sf.jasperreports.engine.data.JsonDataSource)$P{REPORT_DATA_SOURCE}).subDataSource("line_items")]]></dataSourceExpression>
                    </datasetRun>
                    <jr:listContents height="60">
                        <!-- Header for the list -->
                        <frame>
                            <reportElement mode="Opaque" backcolor="#E6E6E6" x="0" y="0" width="555" height="30"/>
                             <staticText>
                                <reportElement style="Header" x="0" y="0" width="185" height="30"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <text><![CDATA[Descripción]]></text>
                            </staticText>
                            <staticText>
                                <reportElement style="Header" x="185" y="0" width="200" height="30"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <text><![CDATA[Detalles Adicionales]]></text>
                            </staticText>
                            <staticText>
                                <reportElement style="Header" x="385" y="0" width="70" height="30"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textElement textAlignment="Center"/>
                                <text><![CDATA[Cantidad]]></text>
                            </staticText>
                            <staticText>
                                <reportElement style="Header" x="455" y="0" width="100" height="30"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textElement textAlignment="Right"/>
                                <text><![CDATA[Subtotal]]></text>
                            </staticText>
                        </frame>
                         <!-- Detail for each item in the list -->
                        <frame>
                           <reportElement x="0" y="30" width="555" height="25"/>
                            <textField isStretchWithOverflow="true">
                                <reportElement style="Detail" x="0" y="0" width="185" height="25"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textFieldExpression><![CDATA[$F{tipo_servicio} + ": " + $F{servicio_descripcion}]]></textFieldExpression>
                            </textField>
                            <textField isStretchWithOverflow="true">
                                <reportElement style="Detail" x="185" y="0" width="200" height="25"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textFieldExpression><![CDATA[$F{servicio_info_adicional_1}]]></textFieldExpression>
                            </textField>
                            <textField>
                                <reportElement style="Detail" x="385" y="0" width="70" height="25"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textElement textAlignment="Center"/>
                                <textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
                            </textField>
                            <textField>
                                <reportElement style="Detail" x="455" y="0" width="100" height="25"/>
                                <box topPadding="2" leftPadding="5" bottomPadding="2" rightPadding="5"/>
                                <textElement textAlignment="Right"/>
                                <textFieldExpression><![CDATA[$F{costo_subtotal}]]></textFieldExpression>
                            </textField>
                        </frame>
                    </jr:listContents>
                </jr:list>
            </componentElement>
        </band>
    </detail>

    <!-- Pie de página con totales -->
    <summary>
        <band height="80">
            <line>
                <reportElement x="0" y="10" width="555" height="1"/>
            </line>
            <staticText>
                <reportElement style="Header" x="355" y="20" width="100" height="20"/>
                <textElement textAlignment="Right"/>
                <text><![CDATA[Compensación:]]></text>
            </staticText>
            <textField>
                <reportElement style="Detail" x="455" y="20" width="100" height="20"/>
                <textElement textAlignment="Right"/>
                <textFieldExpression><![CDATA[$F{p_compensacion}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement style="Header" x="355" y="40" width="100" height="30"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <text><![CDATA[TOTAL: Bs. ]]></text>
            </staticText>
            <textField>
                <reportElement style="Title" x="455" y="40" width="100" height="30"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{p_monto_total}]]></textFieldExpression>
            </textField>
        </band>
    </summary>

</jasperReport>